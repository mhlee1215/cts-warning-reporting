<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ReportItemSql">

	<resultMap id="ReportItem" class="ac.kaist.cts.domain.ReportItem">
		<result column="ID" property="id" />
		<result column="TYPE" property="type" />
		<result column="TITLE" property="title" />
		<result column="TIME" property="time" />
		<result column="TIME_TYPE" property="time_type" />
		<result column="NARRATIVE" property="narrative" />
		<result column="RECOMMENDATION" property="recommendation" />
		<result column="STATUS" property="status" />
		<result column="PRIORITY" property="priority" />
		<result column="REPORT_ID" property="report_id" />
		<result column="REPORT_NO" property="report_no" />
 	</resultMap>
 	
 	
 	<select id="readReportItemList" resultMap="ReportItem">
	SELECT ri.`id`, `report_no`, `type`, `title`, `time`, `time_type`, `narrative`, `recommendation`, `status`, `priority`, `report_id`
 	FROM report_item ri INNER JOIN report rp on ri.report_id = rp.id
	WHERE
	rp.`report_no` = #report_no#
	order by ri.`id` asc
 	</select>
 	 	
	<select id="readReportItem" resultMap="ReportItem">
	SELECT ri.`id`, `report_no`, `type`, `title`, `time`, `time_type`, `narrative`, `recommendation`, `status`, `priority`, `report_id`
 	FROM report_item ri INNER JOIN report rp on ri.report_id = rp.id
	WHERE
	rp.`report_no` = #report_no#
	and
   	type = #type#
	</select>

	<insert id="createReportItem" parameterClass="ac.kaist.cts.domain.ReportItem">
		 INSERT INTO `report_item` 
		 (`type`, `title`, `time`, `time_type`, `narrative`, `recommendation`, `status`, `priority`, `report_id`) VALUES 
		 (#type#, #title#, #time#, #time_type#, #narrative#, #recommendation#, #status#, #priority#, #report_id#);
	</insert>
	
	<update id="updateReportItem" parameterClass="ac.kaist.cts.domain.ReportItem">
		UPDATE `report_item` 
		SET 
			`type` = #type#
			<isNotEmpty property="title">
			, `title`= #title#
			</isNotEmpty>
			<isNotEmpty property="time">
			, `time`= #time#
			</isNotEmpty>
			<isNotEmpty property="time_type">
			, `time_type`= #time_type#
			</isNotEmpty>
			<isNotEmpty property="narrative">
			, `narrative`= #narrative#
			</isNotEmpty>
			<isNotEmpty property="recommendation">
			, `recommendation`= #recommendation#
			</isNotEmpty>
			<isNotEmpty property="status">
			, `status`= #status#
			</isNotEmpty>
			<isNotEmpty property="priority">
			, `priority`= #priority# 
			</isNotEmpty>
		WHERE
		`type` = #type#
		and
		`report_id`= #report_id#
	</update>
	
</sqlMap>


